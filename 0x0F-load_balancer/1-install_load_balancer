#!/usr/bin/env bash
# install and configure HAproxy on your lb-01 server.

if (("$EUID")); then
    exit 1
fi

cat <<EOF | tee -a "/etc/haproxy/haproxy.cfg" > /dev/null

frontend lb_frontend
         bind *:80
         mode http
         default_backend web_servers

backend web_servers
        balance roundrobin
        mode http
        server web_01 34.239.254.5:80 check
        server web_02 100.27.12.254:80 check
EOF

echo "ENABLED=1" | tee -a "/etc/default/haproxy" > /dev/null
systemctl restart haproxy
